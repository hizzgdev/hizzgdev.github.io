---
layout: detail
title: 基于Servlet3.0的JavaEE的组件化设计
---
1. 概述
==========
技术成果的复用对项目的成本、质量、进度等多方面都有比较积极的作用。复用大体可分为四个级别，最高级别的复用是产品级复用，最低级别的复用是技术团队的复用，中间的两个级别是组件级复用（特指业务组件）和代码级复用。对于产品型项目，自然是产品级复用；对于工程型项目，则不同的技术团队能达到的复用程度各不相同。

本文主要介绍的是基于 Servlet 3.0 进行组件化设计的思路，基于此思路可以基本做到组件级复用。

通过组件级复用，实现由多个组件灵活组合，构建一个完整 JavaEE 应用，达到快速交付的目的。

** 本文不会提供相应的源码下载 **

2. Servlet 3.0
==========
Servlet 3.0 于 2010 年随 Java EE 6 规范一起发布。其中有几项特性比较引人注目：异步处理支持/注解支持/插件式支持，具体的内容请参考 IBM developerWorks 的这篇文章：[《Servlet 3.0 新特性详解》][1]。文章中提到：

> 使用该特性（插件式支持），现在我们可以在不修改已有 Web 应用的前提下，只需将按照一定格式打成的 JAR 包放到 WEB-INF/lib 目录下，即可实现新功能的扩充，不需要额外的配置。

> Servlet 3.0 引入了称之为“Web 模块部署描述符片段”的 web-fragment.xml 部署描述文件，该文件必须存放在在 jar 文件的 META-INF 目录下，该部署描述文件可以包含一切可以在 web.xml 中定义的内容。

也即是说在 Servlet3.0 里的 web-fragment.xml 与 web.xml 几乎具备了同等的能力。只不过，在 web.xml 中保留了是否启用这个特性的配置开关，各 web-fragment.xml 也可以指定各自加载的顺序。

另外， jar 文件的 META-INF/resources 目录相当于 JavaEE 工程中的 web 根目录，web 根目录里的文件会覆盖 jar 文件中的同名文件。

3. 需要先解决的问题
==========
JavaEE 工程的模块化设计与一般的 Java 模块相比，除了要做好模块的标识、依赖、接口等的设计及规范之外，还要处理好页面风格、静态资源、数据存储等方面的问题。因为 JavaEE 的业务模块应当包含一个完整的业务功能，界面、逻辑、数据存储都应当在模块内，同时模块还应提供必要的接口或服务以供其它模块使用。以此为目标进行模块化设计，需要先解决几个关键的问题：

3.1. 界面问题
----------
如果业务模块需要包含业务功能的界面，那么如何确保不同的模块有相同的界面风格？

方法一：先设计一套界面，以规范的方式要求每个模块都按此风格进行开发，然而这样以后就不便于进行风格的调整了。

方法二：先定义一套样式名规则，以规范的方式要求每个模块的页面都使用此样式名规则，但模块内部并不包含任何样式表文件、图片、页面模板等，具体的样式表文件、图片、页面模板等则在另一个模块中提供。

3.2. 依赖与引用问题
----------
模块之间必然会有依赖，如何管理好模块的依赖？如何方便各模块互相调用？

可使用 Maven 进行依赖管理。为方便模块间互相调用，可以参考 OSGI 的模型实现，在模块中添加配置文件，或要求每个模块实现一个特定的接口以发布服务，或以规范的形式暴露指定的类包。使用 Spring 管理类之间的引用。

3.3. 配置问题
----------
如何即方便模块管理自身的配置，又方便构建的 JavaEE 应用统一管理所有的配置？

可重载 Spring 的 PropertyPlaceholderConfigurer 类，以通配符的形式配置多个 properties 文件，每个模块都可以有自己的配置文件，应用也有一个配置文件，而且应用的配置文件里的配置可以覆盖模块内的配置信息。

3.4. 调试问题
----------
如何调试业务模块？

可将模块项目作为 Web 项目进行调试，利用 Maven 的 tomcat 插件很容易做到这一点。另外在 Maven 中配置生成 jar 文件的同时生成 source 文件，还可以比较方便的调试到引用的模块内部。

4. 模块化设计
==========
上述几个关键问题解决掉以后，则可以进行如下的设计：

4.1. 总体设计
----------
事实上，模块化设计的本质是模块标准，模块标准中定义了模块内部的结构、外部的接口、以及命名与编程的规范等，所有的符合标准的 jar 文件都可称为模块。而这个标准就是条目化的各种规则，完全可以用一个文档来描述它，然而更理想的描述方法应该是一套承载了这个标准的技术框架或研发平台。

因此在总体设计中，有一个名为“核心”的模块（Core）和一个模块的模板（Template），为了能够比较清晰的描述这个思路，先由模板说起：

** 1）Template **

模板提供了构建一个模块的基本示例，是模块标准的一个具体体现，主要包含三个方面的内容：

* 模块的内部基本结构（包含文件结构与包结构）
* 配置文件模板
* 示例代码

模板以 Maven 的 archetype 方式提供，其内部结构大致如下所示：

    template.jar
        └─src/main/java
            ├─com.company.groupid.artifactid
            │  ├─controller
            │  ├─dao
            │  ├─model
            │  └─service
            └─META-INF
                │  artifactid.properties
                │  MANIFEST.MF
                │  spring-beans-artifactid.xml
                │  web-fragment.xml
                │
                └─resources
                    ├─static
                    │  └─artifactid
                    └─views
                        └─artifactid

模板内部的 artifactid/groupid 可分别用于标识模块的名称和所在的分组。关于模块内部的这些文件稍后会详细介绍。

** 2）Core **

[1]:http://www.ibm.com/developerworks/cn/java/j-lo-servlet30/
